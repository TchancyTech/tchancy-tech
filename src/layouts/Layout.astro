---
interface Props {
  title?: string;
  description?: string;
  lang?: string;
  translations?: string;
  canonicalPath?: string;
  ogImage?: string;
}

const {
  title = 'TCHANCY TECH',
  description = 'TCHANCY TECH builds secure digital solutions including web platforms, mobile apps, enterprise systems, and cybersecurity services.',
  lang = 'en',
  translations,
  canonicalPath = '/',
  ogImage = '/logo.png.png'
} = Astro.props;

const baseUrl = Astro.site ?? new URL(Astro.url.origin);
const canonicalUrl = new URL(canonicalPath, baseUrl).toString();
const ogImageUrl = new URL(ogImage, baseUrl).toString();

// Import translations for navbar/footer
const currentTranslations = await import(`../i18n/${lang}.json`);
const t = currentTranslations.default;

const structuredData = {
  '@context': 'https://schema.org',
  '@graph': [
    {
      '@type': 'Organization',
      name: 'TCHANCY TECH',
      url: canonicalUrl,
      logo: ogImageUrl,
      sameAs: [],
      contactPoint: [
        {
          '@type': 'ContactPoint',
          contactType: 'customer support',
          areaServed: 'Worldwide',
          availableLanguage: ['English', 'French', 'Portuguese', 'Spanish']
        }
      ]
    },
    {
      '@type': 'ProfessionalService',
      name: 'TCHANCY TECH',
      url: canonicalUrl,
      image: ogImageUrl,
      areaServed: 'Worldwide',
      serviceType: [
        'Web Development',
        'Mobile App Development',
        'Enterprise Systems',
        'Cybersecurity Services'
      ]
    }
  ]
};
---
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href={canonicalUrl} />
    <link rel="icon" type="image/png" href="/logo.png.png" />
    <link rel="apple-touch-icon" href="/logo.png.png" />

    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="TCHANCY TECH" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:image" content={ogImageUrl} />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageUrl} />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <title>{title}</title>
    <script is:inline type="application/ld+json" set:html={JSON.stringify(structuredData)}></script>
  </head>
  <body class="bg-white text-text-primary font-sans scroll-smooth" data-translations={translations}>
    <!-- Navbar -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-20">
          <!-- Logo -->
          <div class="flex items-center space-x-3">
            <img src="/logo.png.png" alt="TCHANCY TECH Logo" class="w-16 h-16 object-contain" />
            <div>
              <div class="font-display font-bold text-2xl text-primary-dark">TCHANCY<span class="text-primary-light">TECH</span></div>
              <div class="text-sm text-text-secondary -mt-1">Security & Technology</div>
            </div>
          </div>
          
          <!-- Nav Links -->
          <div class="hidden md:flex space-x-8 items-center">
            <a href="#home" class="text-text-primary hover:text-primary-light transition-colors font-medium text-base lang-nav-home">{t.nav.home}</a>
            <a href="#services" class="text-text-primary hover:text-primary-light transition-colors font-medium text-base lang-nav-services">{t.nav.services}</a>
            <a href="#portfolio" class="text-text-primary hover:text-primary-light transition-colors font-medium text-base lang-nav-portfolio">{t.nav.portfolio}</a>
            <a href="#about" class="text-text-primary hover:text-primary-light transition-colors font-medium text-base lang-nav-about">{t.nav.about}</a>
            <a href="#faq" class="text-text-primary hover:text-primary-light transition-colors font-medium text-base lang-nav-faq">{t.nav.faq}</a>
            <a href="#contact" class="text-text-primary hover:text-primary-light transition-colors font-medium text-base lang-nav-contact">{t.nav.contact}</a>

            <!-- Language Selector -->
            <div class="relative">
              <label for="lang-select-desktop" class="sr-only">Select language</label>
              <select id="lang-select-desktop" class="appearance-none bg-white border border-gray-300 rounded-lg py-2 pl-3 pr-10 text-sm font-medium text-text-primary focus:outline-none focus:ring-2 focus:ring-primary-light focus:border-primary-light transition-colors">
                <option value="en">English</option>
                <option value="fr">Français</option>
                <option value="pt">Português</option>
                <option value="es">Español</option>
              </select>
              <span class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-text-secondary">▾</span>
            </div>
          </div>

          <!-- Mobile Menu Button -->
          <button id="mobile-menu-btn" class="md:hidden p-2 hover:bg-gray-100 rounded-lg transition-colors" aria-label="Open navigation menu" aria-controls="mobile-menu" aria-expanded="false">
            <svg id="menu-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden pb-4 border-t border-gray-200">
          <a href="#home" class="block py-3 px-4 text-text-primary hover:bg-gray-100 rounded-lg transition-colors font-medium lang-nav-home">{t.nav.home}</a>
          <a href="#services" class="block py-3 px-4 text-text-primary hover:bg-gray-100 rounded-lg transition-colors font-medium lang-nav-services">{t.nav.services}</a>
          <a href="#portfolio" class="block py-3 px-4 text-text-primary hover:bg-gray-100 rounded-lg transition-colors font-medium lang-nav-portfolio">{t.nav.portfolio}</a>
          <a href="#about" class="block py-3 px-4 text-text-primary hover:bg-gray-100 rounded-lg transition-colors font-medium lang-nav-about">{t.nav.about}</a>
          <a href="#faq" class="block py-3 px-4 text-text-primary hover:bg-gray-100 rounded-lg transition-colors font-medium lang-nav-faq">{t.nav.faq}</a>
          <a href="#contact" class="block py-3 px-4 text-text-primary hover:bg-gray-100 rounded-lg transition-colors font-medium lang-nav-contact">{t.nav.contact}</a>
          <div class="px-4 pt-3">
            <label for="lang-select-mobile" class="sr-only">Select language</label>
            <select id="lang-select-mobile" class="w-full appearance-none bg-white border border-gray-300 rounded-lg py-2 px-3 text-sm font-medium text-text-primary focus:outline-none focus:ring-2 focus:ring-primary-light focus:border-primary-light transition-colors">
              <option value="en">English</option>
              <option value="fr">Français</option>
              <option value="pt">Português</option>
              <option value="es">Español</option>
            </select>
          </div>
        </div>
      </div>
    </nav>
    <main class="pt-20">
      <slot />
    </main>

    <!-- Footer -->
    <footer class="bg-primary-dark text-white py-8">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <div class="flex items-center space-x-3 mb-4 md:mb-0">
            <img src="/logo.png.png" alt="TCHANCY TECH Logo" class="w-12 h-12 object-contain" />
            <div>
              <div class="font-display font-bold text-xl">TCHANCY<span class="text-accent-cyan">TECH</span></div>
              <div class="text-sm text-gray-300 lang-footer-tagline">{t.footer.tagline}</div>
            </div>
          </div>
          <div class="text-center md:text-right text-sm text-gray-300">
            © 2026 TCHANCY TECH. <span class="lang-footer-rights">{t.footer.rights}</span>
          </div>
        </div>
        <div class="mt-6 pt-6 border-t border-white/10 flex flex-wrap items-center justify-center gap-6 text-sm text-gray-300">
          <span class="font-medium lang-footer-quicklinks">{t.footer.quickLinks}</span>
          <a href="#services" class="hover:text-white transition-colors lang-nav-services">{t.nav.services}</a>
          <a href="#portfolio" class="hover:text-white transition-colors lang-nav-portfolio">{t.nav.portfolio}</a>
          <a href="#about" class="hover:text-white transition-colors lang-nav-about">{t.nav.about}</a>
          <a href="#faq" class="hover:text-white transition-colors lang-nav-faq">{t.nav.faq}</a>
          <a href="#contact" class="hover:text-white transition-colors lang-nav-contact">{t.nav.contact}</a>
        </div>
      </div>
    </footer>

    <!-- Language Switcher Script -->
    <script src="/src/scripts/i18n.js"></script>

    <script is:inline>
      // Parse translations
      const serializedTranslations = document.body?.dataset.translations ?? '{}';
      const allTranslations = JSON.parse(serializedTranslations);
      
      // Setup language switcher after module scripts are ready
      window.addEventListener('DOMContentLoaded', () => {
        window.setupLanguageSwitcher?.(allTranslations);
      });

      // Mobile Menu Toggle
      const mobileMenuBtn = document.getElementById('mobile-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');
      const menuIcon = document.getElementById('menu-icon');

      mobileMenuBtn?.addEventListener('click', () => {
        mobileMenu?.classList.toggle('hidden');
        menuIcon?.classList.toggle('open');
        const isOpen = !mobileMenu?.classList.contains('hidden');
        mobileMenuBtn?.setAttribute('aria-expanded', String(isOpen));
      });

      // Close menu when clicking on a link
      const mobileMenuLinks = mobileMenu?.querySelectorAll('a');
      mobileMenuLinks?.forEach(link => {
        link.addEventListener('click', () => {
          mobileMenu?.classList.add('hidden');
        });
      });

      // Intersection Observer for scroll animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -100px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-in');
            observer.unobserve(entry.target);
          }
        });
      }, observerOptions);

      // Observe all sections
      document.querySelectorAll('section').forEach(section => {
        observer.observe(section);
      });
    </script>

    <style>
      html {
        scroll-behavior: smooth;
      }

      @keyframes slideUpIn {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      section {
        opacity: 0;
      }

      section.animate-in {
        animation: slideUpIn 0.6s ease-out forwards;
      }

      #mobile-menu {
        animation: slideDown 0.3s ease-out;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
